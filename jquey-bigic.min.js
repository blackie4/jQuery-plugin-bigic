!function(i){i.fn.bigic=function(){function t(t){this.$win=i(window),this.$obj=t,this.$popup,this.$img,this.nWinWid=0,this.nWinHei=0,this.nImgWid=0,this.nImgHei=0,this.nImgRate=0,this.sImgStatus,this.sImgSrc,this.bMoveX=!0,this.bMoveY=!0,this.init()}t.prototype.init=function(){var i=this,t=null;this.$obj.off(".bigic").on("click.bigic",function(){var t=this.tagName.toLowerCase();"img"==t?(i.sImgSrc=this.getAttribute("src"),i.sImgStatus="min",i.show()):alert("非IMG标签")}),this.$win.off(".bigic").on("resize.bigic",function(){clearTimeout(t),t=setTimeout(function(){i.zoom()},30)})},t.prototype.show=function(){var t=this,n=new Image;t.popup(),n.onload=function(){t.nImgWid=this.width,t.nImgHei=this.height,t.nImgRate=t.nImgWid/t.nImgHei,i("#LoadingBigic").remove(),t.$popup.append('<img id="imgBigic" class="img-bigic" src="'+t.sImgSrc+'" />'),t.$img=i("#imgBigic"),t.zoom()},n.src=t.sImgSrc},t.prototype.popup=function(){var t="",n=this;t+='<div id="popupBigic" class="popup-bigic" style="width:'+this.nWinWid+"px;height:"+this.nWinHei+'px;"><div class="option-bigic"><span id="changeBigic" class="change-bigic min-bigic" state-bigic="min">放大</span><span id="closeBigic" class="close-bigic">关闭</span></div><img id="LoadingBigic" class="loading-bigic" src="preloader.gif" /></div>',i("body").append(t),n.$popup=i("#popupBigic"),i("#closeBigic").off().on("click",function(){n.$popup.remove()}),i("#changeBigic").off().on("click",function(){document.getElementById("imgBigic")&&(i(this).hasClass("min-bigic")?(n.sImgStatus="max",i(this).removeClass("min-bigic").addClass("max-bigic").html("缩小")):(n.sImgStatus="min",i(this).removeClass("max-bigic").addClass("min-bigic").html("放大")),n.zoom())})},t.prototype.zoom=function(){var t=0,n=0,s=0,e=0,g=0;document.getElementById("popupBigic")&&this.nImgWid&&(this.nWinWid=this.$win.width(),this.nWinHei=this.$win.height(),this.bMoveX=!0,this.bMoveY=!0,i("#changeBigic")[0].style.display=this.nImgWid>this.nWinWid||this.nImgHei>this.nWinHei?"inline-block":"none","min"==this.sImgStatus?(t=this.nImgWid>this.nWinWid?this.nWinWid:this.nImgWid,nHei=t/this.nImgRate,nHei>this.nWinHei&&(nHei=this.nWinHei),t=nHei*this.nImgRate,this.$img.css({width:t+"px",height:nHei+"px",left:"50%",top:"50%","margin-top":-nHei/2+"px","margin-left":-t/2+"px"}),this.$popup.css({width:this.nWinWid+"px",height:this.nWinHei+"px"}),this.move(!1)):(this.nImgWid<this.nWinWid&&(n="50%",e=this.nImgWid/2,this.bMoveX=!1),this.nImgHei<this.nWinHei&&(s="50%",g=this.nImgHei/2,this.bMoveY=!1),this.$img.css({width:this.nImgWid+"px",height:this.nImgHei+"px",left:n,top:s,"margin-top":-g+"px","margin-left":-e+"px"}),this.$popup.css({width:this.nWinWid+"px",height:this.nWinHei+"px"}),this.move(!0)))},t.prototype.move=function(t){var n,s,e,g,o=!1,c=this.nImgWid,h=this.nImgHei,m=this;if(m.$img){if(!t)return m.$img.off(".bigic"),void i(document).off(".bigic");m.$img.off(".bigic").on({"click.bigic":function(i){i.preventDefault()},"mousedown.bigic":function(i){i.preventDefault(),o=!0,n=i.pageX-parseInt(m.$img.css("left")),s=i.pageY-parseInt(m.$img.css("top")),e=m.nWinWid,g=m.nWinHei,m.$img.css("cursor","move")}}),i(document).off(".bigic").on({"mousemove.bigic":function(i){if(i.preventDefault(),o){var t=i.pageX-n,p=i.pageY-s;t>0&&(t=0),p>0&&(p=0),e&&e-c>t&&(t=e-c),g&&g-h>p&&(p=g-h),m.bMoveX&&(m.$img[0].style.left=t+"px"),m.bMoveY&&(m.$img[0].style.top=p+"px")}},"mouseup.bigic":function(){o=!1,m.$img.css("cursor","default")}})}},new t(i(this))}}(jQuery);